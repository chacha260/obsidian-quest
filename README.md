## 📝 企画名（仮）：Obsidian Quest (または Level Up Writer)

### 1\. コンセプト

「書くこと」そのものを冒険にする。Obsidianでの活動量（執筆、リンク、タスク完了）をRPGのステータスに変換し、継続するモチベーションを生み出す。


### 3\. XP（経験値）計算ロジック（Phase 1）

複雑すぎない計算式にします。

- **基本執筆:** 1文字入力 = `1 XP`
	- ※ バックスペースで消しても減算はしない（「推敲」も努力とみなすため。ただしあまりに単純な連打は防ぐロジックを入れるかも）。
- **リンク作成:**`[[ ]]` を完成させた瞬間 = `50 XP`
- **タスク完了:**`- [ ]` を `- [x]` にした瞬間 = `30 XP`
- **レベルアップ式:**
	- 必要XP = `現在のレベル * 1000` （例：Lv.1→2は1000XP、Lv.2→3は2000XP... 徐々に難しくなる）

### 4\. UI / デザイン（Phase 1）

#### A. ステータスバー（画面右下）

常駐して、現在のステータスを控えめに表示します。

Plaintext

```
🛡️ Lv.5 Bard | XP: 450/5000 | 🔥 Streak: 3日
```

- クリックすると詳細パネルが開く。

#### B. レベルアップ通知

レベルが上がった瞬間、Obsidian標準の `Notice` （右上の黒いポップアップ）を使って祝います。

Plaintext

```
🎉 Level Up!
Lv.5 → Lv.6 になりました！
称号が「宮廷詩人」にランクアップ！
```

### 5\. 将来の拡張アイデア（Phase 2以降）

今は作りませんが、コードの設計時に意識しておくべき要素です。

- **HP（体力）概念:** 毎日書かないとHPが減り、瀕死になる（継続の強制）。
- **インベントリ:** 特定の単語（例：「完了」「解決」）を書くと、ランダムで「アイテム」をドロップする。
- **パーティ:** Github連携などで、他人の進捗と競う。

---

### 💡 議論したいポイント

仕様を確定させるために、以下の3点についてどう思いますか？

1. **職業システム:** 最初から「職業」を入れると少し実装が複雑になります。「最初は職業なし（全員共通）」で作り始めますか？ それとも、こだわりとして最初から入れますか？
2. **XPのバランス:** 「1文字1XP」だと、1000文字の日記ですぐレベルが上がります。サクサク上がる方が気持ちいいか、それとも歯ごたえがある方がいいか、どちらが好みですか？
3. **ズル防止:** 「aaaaaaaaa」と適当に打ってもXPが入ります。これを許容するか、簡単な対策（スペースが含まれない長文は無視するなど）を入れるか。個人的には「自分との戦い」なので許容でいい気もします。

ご意見をお聞かせください！それをもとに最終仕様を決定します。

---

1\. 職業は最初から実装しましょう。また、選択する仕組みではなく、パーティー制にして、どの項目でレベルが上がっているのか見るのはどうですか。

2\. 経験値は歯ごたえあるようにしましょう。たくさん文字を書く人向けにしたいです。

3\. ズルを避ける仕組みでコードが複雑難解になることや、エラー処理なども考えると、とりあえずはズル防止は無しの方向でお願いします。

---

承知しました！「選択制」ではなく\*\*「同時進行のパーティ制」\*\*にするというアイデア、非常に面白いです。

これにより、「今日は執筆を頑張ったから吟遊詩人が育った」「今日はタスク整理の日だったから狩人が育った」というように、 **自分の活動スタイルがそのままパーティの強さに反映される** ようになります。

いただいた要望を反映した\*\*確定仕様（Phase 1）\*\*はこちらです。

---

## ⚔️ Obsidian Quest: パーティ・システム仕様書

### 1\. システム概要：3人の冒険者

ユーザーは最初から3人のキャラクター（職業）を連れています。Obsidianでの特定の操作が、それぞれのキャラクターの経験値（XP）として自動的に振り分けられます。

※ ズル防止機能は実装せず、ユーザーの良心に任せるシンプルな設計にします。

### 2\. レベルデザイン：歯ごたえのある「ハードモード」

「たくさん文字を書く人」が達成感を感じられるよう、初期レベルから必要XPを高めに設定します。

- **基本レート:** 1文字 = 1 XP
- **レベル計算式:**
	- 単純な比例（Lv \* 1000）ではなく、レベルが上がるごとに必要量が跳ね上がる **累積型** にします。
	- **Lv.1 → Lv.2:** 必要 **5,000 XP** （原稿用紙 約12枚分）
	- **Lv.2 → Lv.3:** 必要 **12,000 XP**
	- **Lv.3以降:** 前のレベルの必要XP × 1.5倍 程度
- **狙い:**
	- Lv.10を超える頃には、相当なヘビーユーザー（または長編小説の執筆者）として称えられるバランスです。

### 3\. UIイメージ

- **ステータスバー（常時表示）:**
	- 現在一番レベルが高いキャラクター（リーダー）を表示、または3人のレベルをコンパクトに並べます。
	- 例: `🎵Lv.5 📖Lv.2 🏹Lv.8` （絵文字で表現）
- **パーティ画面（コマンドで呼び出し）:**
	- 3人の詳細なステータスと、次のレベルまでの残りXPを表示するモーダルウィンドウ。

---

## 🚀 開発スタート：データの設計

まずは、このプラグインの土台となる\*\*「データの型（TypeScript Interface）」\*\*を作成しましょう。これが全ての基準になります。

開発環境（VS Codeなど）の準備は大丈夫でしょうか？ Obsidianのプラグイン開発テンプレート（ `obsidian-sample-plugin` ）をcloneした状態、あるいは空のプロジェクトから始める想定で、最初のコードを提示します。

### 次のアクション

このデータ構造で良さそうであれば、次は\*\*「文字を書いたときにBardのXPを増やす」\*\*という核心部分のコード作成に進みます。

1. このデータ構造でOKですか？（職業名の変更などはありますか？）
2. 開発環境のセットアップ（ `npm install` など）は完了していますか？まだなら手順を案内します。

どちらに進めましょうか？

---

職業名を変えます。RPGといえば勇者は欠かせないと思います。デフォルトの文字入力でレベルアップする人を勇者にしましょう。また、コピペでレベルアップする人を追加し、遊び人としましょう。

---

いいですね！「勇者」と「遊び人」が入ることで、RPGらしさとユーモアが一気に増しました。

特に\*\*「遊び人（Playboy）」\*\*の実装は技術的にも面白いです。「地道に書く勇者」と「他所から持ってくる遊び人」という対比がコード上でも明確になります。

それでは、 **確定したパーティ構成** と、それを反映した **データ構造のコード** を作成します。

---

## ⚔️ 新・パーティ構成

| キャラクター | 役割 | XP獲得トリガー | 実装ロジックの判定 |
| --- | --- | --- | --- |
| **勇者 (Hero)** | **執筆（努力）** | 1文字入力 | 一度に挿入された文字数が「1文字」の場合 |
| **遊び人 (Playboy)** | **コピペ（楽）** | テキスト貼り付け | 一度に挿入された文字数が「2文字以上」の場合※ |
| **賢者 (Scholar)** | **連結（知識）** | リンク作成 `[[]]` | テキスト内に `[[ ]]` が増えたことを検知 |
| **狩人 (Hunter)** | **達成（実務）** | タスク完了 `- [x]` | テキスト内の `- [ ]` が `- [x]` に変わったことを検知 |

※「2文字以上同時に入力された＝ペーストされた」とみなす簡易ロジックで判定します。（高速タイピングでも1文字ずつイベントが発火するため、これで概ね判別可能です）

---


ここまで出来たら教えてください。 次は先ほどのコード（勇者・遊び人・賢者・狩人）を実際に組み込んでいきます！

---

できました。お願いします

---

環境構築完了、おめでとうございます！🎉 これであなたは「Obsidianの機能を使う側」から\*\*「作る側」\*\*の領域に踏み込みました。

それでは、 `main.ts` の内容をすべて書き換えて、\*\*「勇者（執筆）」 **と** 「遊び人（コピペ）」\*\*が活躍するシステムを実装しましょう。

以下のコードをコピーして、VS Codeの `main.ts` に **すべて上書き** （既存の内容を全部消して貼り付け）してください。



### 🕹 動作確認の手順

コードを保存したら、すぐにテストできます（ `npm run dev` が動いていれば自動で反映されます）。

1. **Obsidianを開く:**
	- 右下のステータスバーを見てください。「⚔️Lv.1 🍷Lv.1」と表示されていますか？
2. **勇者のテスト:**
	- 適当なノートで文字をパチパチ打ってください。
	- しばらく打ち続けると…… **右上に黒いポップアップで「勇者がレベルアップ！」と出る** はずです！（テスト用に必要XPを100と低くしてあります）
3. **遊び人のテスト:**
	- ウェブサイトや別のメモから長めの文章をコピーして、ペーストしてください。
	- 一瞬で「遊び人がレベルアップ！」するはずです。

### ❓ うまくいかない場合

- ステータスバーが出ない → Obsidianを再起動（ `Cmd+R` または `Ctrl+R` ）してみてください。
- エラーが出る → VS Codeのターミナルに赤い文字が出ていないか確認してください。

無事にレベルアップ通知は出ましたか？

---

レベルアップ通知は出ますが、レベルが書いてある部分が自動で隠れてしまい(設定かも)わかりにくいので、リボンでいつでもステータスを呼び出せるようにしたり、ドット絵で各キャラを表現したいです。

---

ステータスバーは便利ですが、確かにテーマによっては隠れたり、情報量に限界がありますね。

\*\*「リボンアイコン（左側のメニュー）」 **をクリックすると、** 「ドット絵つきのステータス画面」\*\*がバァーン！と開くように改造しましょう。これができれば一気にゲームっぽくなります。

今回は\*\* `main.ts` **（プログラム）だけでなく、見た目を整えるための** `styles.css` \*\*（デザイン）も編集します。

---

### 1\. styles.css の作成

まずは、ステータス画面をRPGのメニューっぽくするためのデザインを追加します。 プラグインフォルダ（ `main.ts` と同じ場所）にある `styles.css` を開き、以下のコードを追記してください。



今回は、手元に画像ファイルがなくてもすぐにドット絵が表示されるよう、\*\*「DiceBear」\*\*という無料のドット絵生成APIを使っています（インターネット接続が必要です）。


### ⚔️ 動作確認をしましょう

1. ファイルを保存し、Obsidianでプラグインをリロードします（リロードボタンを押すか、Obsidianを再起動）。
2. \*\*左側のリボン（サイドバー） **を見てください。** 「剣のアイコン」\*\*が増えているはずです。
3. クリックしてみてください。

どうでしょう？ ドット絵のキャラクターたちが並んだ、\*\*「冒険の記録」\*\*ウィンドウが開きましたか？ 勇者や遊び人のレベルやXPバーが表示されていれば成功です！

もし「自分の好きな画像に変えたい！」という場合は、 `main.ts` の `imgUrl` の部分を、自分のPC内の画像パスなどに書き換えることで変更できます。まずはこれで遊んでみてください！
