# ⚔️ Obsidian Quest

**Obsidianでの執筆活動を「冒険」に変える、ゲーミフィケーション・プラグイン。**

Obsidian Questは、あなたのライティング、知識整理、タスク消化といった活動をRPGのステータス（経験値）に変換します。単なる文字数カウントではなく、**「どう書いたか」によって異なるキャラクターが成長するパーティ制システム**を採用しています。

## 🗺 概要
ユーザーの行動（執筆、コピペ、リンク作成など）に応じて、異なるRPGキャラクター（勇者、遊び人など）がレベルアップするパーティ制システムです。

## 📂 ファイル構成 (File Structure)

```text
obsidian-quest/
├── main.ts         # ロジック中枢 (Party System, Editor Event Listener)
├── styles.css      # UIデザイン (Pixel Art Status Screen, Ribbon)
├── manifest.json   # プラグイン定義 (ID: obsidian-quest)
├── package.json    # 依存関係
└── README.md       # 本ドキュメント
```

## 👥 実装済みキャラクター (Implemented)
| キャラクター | ID | トリガー | 実装ロジック (`main.ts`) |
| --- | --- | --- | --- |
| 勇者 (Hero) | `hero` | 1文字入力 | `diff === 1` |
| 遊び人 (Playboy) | `playboy` | ペースト | `diff > 1` |

## 🚧 実装待ちキャラクター (To Do)
以下のキャラクターはデータ構造 (`ObsidianQuestSettings`) には存在しますが、ロジックが未実装です。
| キャラクター | ID | トリガー | 実装のヒント |
| --- | --- | --- | --- |
| 賢者 (Scholar) | `scholar` | リンク作成 `[[ ]]` | `editor-change`で正規表現 `\[\[.*?\]\]`の数をカウント比較、または `metadataCache`イベントを利用。 |
| 狩人 (Hunter) | `hunter` | タスク完了 `- [x]` | 正規表現`- \[x\]`の増加を検知。 |

## 🛠 開発環境のセットアップ
```Bash
# 依存関係のインストール
npm install

# 開発ビルド (監視モード)
npm run dev
```
## 🎨 UI / デザイン
- リボンアイコン: サイドバーの「剣アイコン」でステータス画面を起動。
- アバター: DiceBear API を使用して動的にピクセルアートを生成 (Online only)。
- スタイル: styles.css にてGrid Layoutを使用。

💾 データ保存
data.json にパーティ全員のレベル・XP・次の必要XPを永続化しています。


---

### 🤝 3. Antigravityへの引き継ぎプロンプト（申し送り事項）

Antigravityに開発を引き継ぐ際は、以下のメッセージと一緒にファイルを渡すとスムーズです。

> **プロンプト案:**
>
> 「Obsidian用のRPG風ライティング・プラグイン『Obsidian Quest』の開発を引き継ぎます。
>
> **現状:**
> * 環境構築済み（TypeScript + Obsidian API）。
> * 基本システム（設定保存、UI表示、文字数カウントロジック）は完成。
> * 『勇者（執筆）』と『遊び人（コピペ）』のレベルアップ機能は動作確認済み。
>
> **次のタスク:**
> * 未実装である**『賢者（WikiLink作成でXP獲得）』**と**『狩人（チェックボックス完了でXP獲得）』**のロジックを `main.ts` に追加したいです。
> * 賢者は正規表現かメタデータキャッシュ、狩人はチェックボックスの状態変化を検知する必要があります。
>
> ファイル一式を渡しますので、コードを解析して続きの実装案を出してください。」

---

## 🗺 コンセプト

「書くことは、冒険だ。」

孤独になりがちな執筆作業や、面倒なナレッジ管理を、目に見える「成長」として可視化します。
ユーザーは3〜4人の冒険者パーティを率いています。あなたのObsidianでの振る舞いに応じて、対応するキャラクターが勝手に育っていきます。

## 👥 パーティ・システム (The Party)

このプラグインの最大の特徴です。アクションの種類によって経験値が入るキャラクターが異なります。

| キャラクター | アイコン | 役割 | 成長トリガー | 意味合い |
| :--- | :---: | :--- | :--- | :--- |
| **勇者 (Hero)** | ⚔️ | **執筆** | 1文字ずつの入力 | 努力の証。地道にキーボードを叩いた量。 |
| **遊び人 (Playboy)** | 🍷 | **引用** | テキストのペースト | 情報収集力。外部からリソースを持ち込んだ量。 |
| **賢者 (Scholar)** | 📖 | **連結** | リンク作成 `[[ ]]` | 知識の結合。脳内ネットワークの広がり。 |
| **狩人 (Hunter)** | 🏹 | **達成** | タスク完了 `- [x]` | 実行力。完了させたタスクの数。 |

> **Note:** 現在のバージョンでは「勇者」と「遊び人」の判定ロジックが実装済みです。「賢者」と「狩人」はデータ構造に含まれており、ロジック実装待ちの状態です。

## 🎮 機能 (Features)

  * **リアルタイムXP取得:** エディタでの操作を監視し、即座に経験値を計算。
  * **レベルアップ通知:** 閾値を超えると、派手なトースト通知で祝福します。
  * **ハードモード設定:** レベルが上がるごとに必要経験値が跳ね上がる、書き手への挑戦状仕様。
  * **ステータス画面 (Ribbon UI):**
      * サイドバーの「剣アイコン」から呼び出し。
      * **DiceBear API** を利用したドット絵アバターの自動生成。
      * 現在のレベルと次のレベルまでのプログレスバー表示。

## 🛠 技術スタックと実装ポイント (For Developers)

自作プラグインとして拡張性を重視した設計になっています。

  * **Framework:** Obsidian API (TypeScript)
  * **UI:** Vanilla JS + CSS Grid Layout (ステータス画面)
  * **Assets:** DiceBear Pixel Art API (アバター生成)
  * **Data Persistence:** `data.json` への自動保存

### 判定ロジックのキモ

`editor-change` イベントをフックし、変更前後の文字数差分 (`diff`) を計算しています。

```typescript
if (diff === 1) {
    // タイピング (勇者のXP)
} else if (diff > 1) {
    // ペースト (遊び人のXP)
}
```

## 🚀 ロードマップ (Roadmap)

### Phase 1: MVP (完了/現在地)

  - [x] 勇者・遊び人の判定ロジック
  - [x] 基本的なレベルアップ計算
  - [x] ステータス画面のUI実装
  - [x] ドット絵の表示

### Phase 2: ロジック拡張 (Next Steps)

  - [ ] **賢者のロジック:** 正規表現で `[[...]]` の増加を検知。
  - [ ] **狩人のロジック:** `metadataCache` またはエディタ変更で `- [x]` の増加を検知。

### Phase 3: ゲーム性の強化 (Future)

  - [ ] **HPシステム:** 毎日書かないとHPが減り、瀕死になる（継続の強制）。
  - [ ] **アバターカスタマイズ:** 自分の好きな画像をローカルから設定可能に。
  - [ ] **ドロップアイテム:** 特定のキーワード（「完了」「解決」など）を書くとアイテム獲得。

## 📦 インストール方法 (開発者向け)

1.  このリポジトリを `YourVault/.obsidian/plugins/obsidian-quest` にクローン/配置。
2.  依存関係をインストール: `npm install`
3.  ビルドと監視を開始: `npm run dev`
4.  Obsidianの「コミュニティプラグイン」設定で有効化。

## 📜 License

MIT License

-----

**さあ、ペン（キーボード）を取れ。冒険の始まりだ！**
